import React, { useState, useEffect } from 'react';
import { AlertCircle, TrendingUp, DollarSign, Users, Zap, Target, Shield, Database } from 'lucide-react';

const DefenseStartupSim = () => {
  const [gameState, setGameState] = useState({
    quarter: 1,
    year: 2025,
    cash: 5000000,
    runway: 12,
    valuation: 20000000,
    employees: 15,
    morale: 75,
    products: {
      aiSurveillance: { progress: 20, marketFit: 30 },
      autonomousDrone: { progress: 0, marketFit: 0 },
      cyberDefense: { progress: 0, marketFit: 0 }
    },
    contracts: [],
    reputation: 50,
    militaryRelations: 40,
    techAdvancement: 35,
    burnRate: 450000,
    revenue: 100000,
    activeAlert: null
  });

  const [logs, setLogs] = useState([
    { time: 'Q1 2025', message: 'COMMAND INITIALIZED. Welcome, Commander. Your defense tech startup awaits orders.', type: 'info' }
  ]);

  const addLog = (message, type = 'info') => {
    setLogs(prev => [{ time: `Q${gameState.quarter} ${gameState.year}`, message, type }, ...prev].slice(0, 8));
  };

  const advanceQuarter = () => {
    setGameState(prev => {
      const newQuarter = prev.quarter === 4 ? 1 : prev.quarter + 1;
      const newYear = prev.quarter === 4 ? prev.year + 1 : prev.year;
      const netCash = prev.cash + prev.revenue - prev.burnRate;
      const newRunway = Math.max(0, Math.floor(netCash / prev.burnRate));

      // Random events
      const events = [
        { chance: 0.15, effect: () => {
          addLog('ALERT: Competitor announced major breakthrough. Market pressure increasing.', 'warning');
          return { reputation: prev.reputation - 5 };
        }},
        { chance: 0.1, effect: () => {
          addLog('OPPORTUNITY: DoD released new RFP matching our capabilities.', 'success');
          return { militaryRelations: prev.militaryRelations + 10 };
        }},
        { chance: 0.08, effect: () => {
          addLog('CRITICAL: Key engineer received competing offer. Morale impact detected.', 'error');
          return { morale: prev.morale - 10 };
        }}
      ];

      let updates = {};
      events.forEach(event => {
        if (Math.random() < event.chance) {
          updates = { ...updates, ...event.effect() };
        }
      });

      // Progress products in development
      const newProducts = { ...prev.products };
      Object.keys(newProducts).forEach(key => {
        if (newProducts[key].progress > 0 && newProducts[key].progress < 100) {
          newProducts[key].progress = Math.min(100, newProducts[key].progress + 5);
        }
      });

      return {
        ...prev,
        ...updates,
        quarter: newQuarter,
        year: newYear,
        cash: netCash,
        runway: newRunway,
        products: newProducts
      };
    });
    
    addLog(`Quarter advanced. Systems nominal. Cash reserves: $${(gameState.cash / 1000000).toFixed(1)}M`, 'info');
  };

  const executeAction = (action) => {
    switch(action) {
      case 'hire':
        if (gameState.cash > 500000) {
          setGameState(prev => ({
            ...prev,
            employees: prev.employees + 5,
            cash: prev.cash - 500000,
            burnRate: prev.burnRate + 50000,
            morale: Math.min(100, prev.morale + 5)
          }));
          addLog('PERSONNEL: Hired 5 new engineers. Team capacity increased.', 'success');
        } else {
          addLog('DENIED: Insufficient funds for hiring operation.', 'error');
        }
        break;

      case 'raiseFunding':
        const dilution = 15;
        const funding = 10000000;
        setGameState(prev => ({
          ...prev,
          cash: prev.cash + funding,
          valuation: prev.valuation * 1.5,
          runway: Math.floor((prev.cash + funding) / prev.burnRate)
        }));
        addLog(`CAPITAL SECURED: Raised $${funding / 1000000}M Series A. ${dilution}% dilution.`, 'success');
        break;

      case 'developAI':
        if (gameState.products.aiSurveillance.progress < 100) {
          setGameState(prev => ({
            ...prev,
            products: {
              ...prev.products,
              aiSurveillance: {
                progress: Math.min(100, prev.products.aiSurveillance.progress + 15),
                marketFit: Math.min(100, prev.products.aiSurveillance.marketFit + 10)
              }
            },
            techAdvancement: Math.min(100, prev.techAdvancement + 8)
          }));
          addLog('R&D: AI Surveillance development accelerated. Progress updated.', 'info');
        } else {
          addLog('STATUS: AI Surveillance already complete. Deploy to generate revenue.', 'warning');
        }
        break;

      case 'developDrone':
        setGameState(prev => ({
          ...prev,
          products: {
            ...prev.products,
            autonomousDrone: {
              progress: Math.max(prev.products.autonomousDrone.progress, 15),
              marketFit: 20
            }
          },
          cash: prev.cash - 800000,
          techAdvancement: Math.min(100, prev.techAdvancement + 12)
        }));
        addLog('R&D: Autonomous Drone program initiated. High-risk, high-reward path.', 'info');
        break;

      case 'bidContract':
        if (gameState.militaryRelations > 50) {
          const contractValue = 2000000;
          setGameState(prev => ({
            ...prev,
            contracts: [...prev.contracts, { name: 'DoD Pilot', value: contractValue, quarter: prev.quarter }],
            revenue: prev.revenue + contractValue / 4,
            reputation: Math.min(100, prev.reputation + 15),
            militaryRelations: Math.min(100, prev.militaryRelations + 10)
          }));
          addLog(`CONTRACT AWARDED: DoD Pilot Program - $${contractValue / 1000000}M value.`, 'success');
        } else {
          addLog('BID REJECTED: Military relations insufficient. Build credibility first.', 'error');
        }
        break;

      case 'marketing':
        setGameState(prev => ({
          ...prev,
          cash: prev.cash - 200000,
          reputation: Math.min(100, prev.reputation + 10),
          militaryRelations: Math.min(100, prev.militaryRelations + 5)
        }));
        addLog('COMMS: Marketing campaign launched. Brand visibility increased.', 'info');
        break;

      case 'optimize':
        setGameState(prev => ({
          ...prev,
          burnRate: Math.max(300000, prev.burnRate * 0.85),
          morale: Math.max(0, prev.morale - 8)
        }));
        addLog('EFFICIENCY: Burn rate reduced 15%. Morale impact noted.', 'warning');
        break;

      case 'teamBuilding':
        setGameState(prev => ({
          ...prev,
          cash: prev.cash - 100000,
          morale: Math.min(100, prev.morale + 15)
        }));
        addLog('PERSONNEL: Team building event completed. Morale boost confirmed.', 'success');
        break;
    }
  };

  const getStatusColor = (value) => {
    if (value >= 70) return 'text-green-400';
    if (value >= 40) return 'text-yellow-400';
    return 'text-red-400';
  };

  const getRunwayColor = (runway) => {
    if (runway >= 12) return 'text-green-400';
    if (runway >= 6) return 'text-yellow-400';
    return 'text-red-400';
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-gray-900 via-blue-900 to-gray-900 text-white p-6 font-mono">
      {/* Header */}
      <div className="mb-6 border-2 border-cyan-500 bg-black bg-opacity-70 p-4 rounded-lg">
        <div className="flex justify-between items-center">
          <div>
            <h1 className="text-3xl font-bold text-cyan-400 mb-1">DEFENSE TECH COMMAND BRIDGE</h1>
            <p className="text-sm text-gray-400">Mission Clock: Q{gameState.quarter} {gameState.year} | Status: OPERATIONAL</p>
          </div>
          <div className="text-right">
            <div className="text-2xl font-bold text-green-400">${(gameState.cash / 1000000).toFixed(2)}M</div>
            <div className={`text-sm ${getRunwayColor(gameState.runway)}`}>Runway: {gameState.runway} months</div>
          </div>
        </div>
      </div>

      {/* Status Panels */}
      <div className="grid grid-cols-4 gap-4 mb-6">
        <div className="border border-cyan-500 bg-black bg-opacity-60 p-4 rounded">
          <div className="flex items-center mb-2">
            <Users className="w-5 h-5 mr-2 text-cyan-400" />
            <span className="text-xs text-gray-400">PERSONNEL</span>
          </div>
          <div className="text-2xl font-bold">{gameState.employees}</div>
          <div className="text-xs mt-1">
            <span className={getStatusColor(gameState.morale)}>Morale: {gameState.morale}%</span>
          </div>
        </div>

        <div className="border border-cyan-500 bg-black bg-opacity-60 p-4 rounded">
          <div className="flex items-center mb-2">
            <TrendingUp className="w-5 h-5 mr-2 text-cyan-400" />
            <span className="text-xs text-gray-400">REPUTATION</span>
          </div>
          <div className={`text-2xl font-bold ${getStatusColor(gameState.reputation)}`}>{gameState.reputation}%</div>
          <div className="text-xs mt-1 text-gray-400">Market Position</div>
        </div>

        <div className="border border-cyan-500 bg-black bg-opacity-60 p-4 rounded">
          <div className="flex items-center mb-2">
            <Shield className="w-5 h-5 mr-2 text-cyan-400" />
            <span className="text-xs text-gray-400">MIL RELATIONS</span>
          </div>
          <div className={`text-2xl font-bold ${getStatusColor(gameState.militaryRelations)}`}>{gameState.militaryRelations}%</div>
          <div className="text-xs mt-1 text-gray-400">DoD Standing</div>
        </div>

        <div className="border border-cyan-500 bg-black bg-opacity-60 p-4 rounded">
          <div className="flex items-center mb-2">
            <Zap className="w-5 h-5 mr-2 text-cyan-400" />
            <span className="text-xs text-gray-400">TECH LEVEL</span>
          </div>
          <div className={`text-2xl font-bold ${getStatusColor(gameState.techAdvancement)}`}>{gameState.techAdvancement}%</div>
          <div className="text-xs mt-1 text-gray-400">Innovation Index</div>
        </div>
      </div>

      {/* Main Display */}
      <div className="grid grid-cols-3 gap-6 mb-6">
        {/* Product Development */}
        <div className="border-2 border-cyan-500 bg-black bg-opacity-70 p-4 rounded-lg">
          <h2 className="text-lg font-bold text-cyan-400 mb-4 flex items-center">
            <Database className="w-5 h-5 mr-2" />
            R&D PROGRAMS
          </h2>
          <div className="space-y-3">
            {Object.entries(gameState.products).map(([key, product]) => (
              <div key={key} className="border border-gray-600 p-3 rounded">
                <div className="text-sm font-bold mb-1">
                  {key === 'aiSurveillance' ? 'AI Surveillance' : 
                   key === 'autonomousDrone' ? 'Autonomous Drone' : 
                   'Cyber Defense'}
                </div>
                <div className="flex justify-between text-xs mb-1">
                  <span>Progress:</span>
                  <span className={getStatusColor(product.progress)}>{product.progress}%</span>
                </div>
                <div className="w-full bg-gray-700 h-2 rounded">
                  <div 
                    className="bg-cyan-500 h-2 rounded transition-all"
                    style={{ width: `${product.progress}%` }}
                  />
                </div>
                <div className="flex justify-between text-xs mt-1">
                  <span>Market Fit:</span>
                  <span className={getStatusColor(product.marketFit)}>{product.marketFit}%</span>
                </div>
              </div>
            ))}
          </div>
        </div>

        {/* Command Log */}
        <div className="border-2 border-cyan-500 bg-black bg-opacity-70 p-4 rounded-lg">
          <h2 className="text-lg font-bold text-cyan-400 mb-4">COMMAND LOG</h2>
          <div className="space-y-2 text-xs h-80 overflow-y-auto">
            {logs.map((log, idx) => (
              <div 
                key={idx} 
                className={`p-2 rounded ${
                  log.type === 'error' ? 'bg-red-900 bg-opacity-30 border-l-2 border-red-500' :
                  log.type === 'warning' ? 'bg-yellow-900 bg-opacity-30 border-l-2 border-yellow-500' :
                  log.type === 'success' ? 'bg-green-900 bg-opacity-30 border-l-2 border-green-500' :
                  'bg-gray-800 bg-opacity-30'
                }`}
              >
                <div className="text-gray-400">[{log.time}]</div>
                <div>{log.message}</div>
              </div>
            ))}
          </div>
        </div>

        {/* Financial Status */}
        <div className="border-2 border-cyan-500 bg-black bg-opacity-70 p-4 rounded-lg">
          <h2 className="text-lg font-bold text-cyan-400 mb-4 flex items-center">
            <DollarSign className="w-5 h-5 mr-2" />
            FINANCIAL
          </h2>
          <div className="space-y-3 text-sm">
            <div className="flex justify-between border-b border-gray-600 pb-2">
              <span>Cash Reserves:</span>
              <span className="font-bold text-green-400">${(gameState.cash / 1000000).toFixed(2)}M</span>
            </div>
            <div className="flex justify-between border-b border-gray-600 pb-2">
              <span>Burn Rate:</span>
              <span className="font-bold text-red-400">${(gameState.burnRate / 1000).toFixed(0)}K/mo</span>
            </div>
            <div className="flex justify-between border-b border-gray-600 pb-2">
              <span>Revenue:</span>
              <span className="font-bold text-green-400">${(gameState.revenue / 1000).toFixed(0)}K/mo</span>
            </div>
            <div className="flex justify-between border-b border-gray-600 pb-2">
              <span>Valuation:</span>
              <span className="font-bold">${(gameState.valuation / 1000000).toFixed(1)}M</span>
            </div>
            <div className="mt-4 p-3 bg-gray-800 rounded">
              <div className="text-xs text-gray-400 mb-2">ACTIVE CONTRACTS</div>
              {gameState.contracts.length === 0 ? (
                <div className="text-xs text-gray-500">No active contracts</div>
              ) : (
                gameState.contracts.map((contract, idx) => (
                  <div key={idx} className="text-xs mb-1">
                    {contract.name}: ${(contract.value / 1000000).toFixed(1)}M
                  </div>
                ))
              )}
            </div>
          </div>
        </div>
      </div>

      {/* Command Actions */}
      <div className="grid grid-cols-4 gap-4 mb-6">
        <div className="border border-cyan-500 bg-black bg-opacity-60 p-4 rounded">
          <h3 className="text-sm font-bold text-cyan-400 mb-3">OPERATIONS</h3>
          <div className="space-y-2">
            <button 
              onClick={() => executeAction('hire')}
              className="w-full bg-blue-600 hover:bg-blue-500 p-2 rounded text-sm transition-colors"
            >
              Hire Engineers ($500K)
            </button>
            <button 
              onClick={() => executeAction('optimize')}
              className="w-full bg-blue-600 hover:bg-blue-500 p-2 rounded text-sm transition-colors"
            >
              Optimize Operations
            </button>
            <button 
              onClick={() => executeAction('teamBuilding')}
              className="w-full bg-blue-600 hover:bg-blue-500 p-2 rounded text-sm transition-colors"
            >
              Team Building ($100K)
            </button>
          </div>
        </div>

        <div className="border border-cyan-500 bg-black bg-opacity-60 p-4 rounded">
          <h3 className="text-sm font-bold text-cyan-400 mb-3">R&D</h3>
          <div className="space-y-2">
            <button 
              onClick={() => executeAction('developAI')}
              className="w-full bg-purple-600 hover:bg-purple-500 p-2 rounded text-sm transition-colors"
            >
              Accelerate AI Dev
            </button>
            <button 
              onClick={() => executeAction('developDrone')}
              className="w-full bg-purple-600 hover:bg-purple-500 p-2 rounded text-sm transition-colors"
            >
              Start Drone Program
            </button>
          </div>
        </div>

        <div className="border border-cyan-500 bg-black bg-opacity-60 p-4 rounded">
          <h3 className="text-sm font-bold text-cyan-400 mb-3">BUSINESS</h3>
          <div className="space-y-2">
            <button 
              onClick={() => executeAction('bidContract')}
              className="w-full bg-green-600 hover:bg-green-500 p-2 rounded text-sm transition-colors"
            >
              Bid DoD Contract
            </button>
            <button 
              onClick={() => executeAction('marketing')}
              className="w-full bg-green-600 hover:bg-green-500 p-2 rounded text-sm transition-colors"
            >
              Marketing Push ($200K)
            </button>
            <button 
              onClick={() => executeAction('raiseFunding')}
              className="w-full bg-green-600 hover:bg-green-500 p-2 rounded text-sm transition-colors"
            >
              Raise Series A ($10M)
            </button>
          </div>
        </div>

        <div className="border border-cyan-500 bg-black bg-opacity-60 p-4 rounded">
          <h3 className="text-sm font-bold text-cyan-400 mb-3">TIME CONTROL</h3>
          <button 
            onClick={advanceQuarter}
            className="w-full bg-cyan-600 hover:bg-cyan-500 p-3 rounded text-lg font-bold transition-colors"
          >
            ADVANCE QUARTER
          </button>
          <div className="mt-3 text-xs text-center text-gray-400">
            Execute strategic decisions then advance time
          </div>
        </div>
      </div>

      {/* Footer */}
      <div className="border-t border-cyan-500 pt-4 text-center text-xs text-gray-500">
        CLASSIFIED DEFENSE SYSTEMS // COMMAND AUTHORITY LEVEL: FOUNDER
      </div>
    </div>
  );
};

export default DefenseStartupSim;
